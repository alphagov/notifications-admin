{% extends "withnav_template.html" %}
{% from "components/sms-message.html" import sms_message %}
{% from "components/email-message.html" import email_message %}
{% from "components/page-footer.html" import page_footer %}
{% from "components/file-upload.html" import file_upload %}
{% from "components/table.html" import list_table, text_field, index_field, index_field_heading %}

{% block page_title %}
  Send text messages â€“ GOV.UK Notify
{% endblock %}

{% block maincolumn_content %}

  <h1 class="heading-large">Send {{ 'text messages' if 'sms' == template.template_type else 'emails' }}</h1>

  {% if 'sms' == template.template_type %}
    <div class="grid-row">
      <div class="column-two-thirds">
        {{ sms_message(
          template.formatted_as_markup,
          recipient='',
          show_placeholder_for_recipient=True
        ) }}
      </div>
    </div>
  {% elif 'email' == template.template_type %}
    {{ email_message(
      template.formatted_subject_as_markup,
      template.formatted_as_markup,
      recipient='',
      show_placeholder_for_recipient=True
    ) }}
  {% endif %}

  <div class="page-footer bottom-gutter">
    {{file_upload(
      form.file,
      button_text='Upload a file of recipients',
      alternate_link=url_for(".send_test", service_id=current_service.id, template_id=template.id),
      alternate_link_text='send yourself a test'
    )}}
  </div>

  <details role="group">
    <summary role="button" aria-controls="how-to-format-your-file" aria-expanded="false">
      <span class="summary">How to format your file</span>
    </summary>

    <div id="how-to-format-your-file" aria-hidden="true">
      <ul class="list list-bullet">
        <li>
          put one recipient per row
        </li>
        <li>
          save or export your data as a
          <acronym title="Comma Separated Values">CSV</acronym>,
          <acronym title="Comma Separated Values">TSV</acronym>,
          Open Document Spreadsheet (.ods)
          or Microsoft Excel (.xls, .xlsx, .xlsm) file
        </li>
      </ul>

      <h2 class="heading-small">
        Example file
      </h2>

      {% call(item, row_number) list_table(
        example,
        caption="Example",
        caption_visible=False,
        field_headings=['1'] + [
          '<span class="placeholder">{}</span>'.format(recipient_column)|safe
        ] + template.placeholders_as_markup|list
      ) %}
        {{ index_field(row_number) }}
        {% for column in item %}
          {{ text_field(column) }}
        {% endfor %}
      {% endcall %}
      <p class="table-show-more-link">
        <a href="{{ url_for('.get_example_csv', service_id=current_service.id, template_id=template.id) }}">Download this example</a>
      </p>
    </div>
  </details>

{% endblock %}
