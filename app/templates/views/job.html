{% extends "withnav_template.html" %}
{% from "components/table.html" import list_table, field, right_aligned_field_heading %}
{% from "components/big-number.html" import big_number %}
{% from "components/banner.html" import banner %}

{% block page_title %}
GOV.UK Notify | Notifications activity
{% endblock %}

{% block maincolumn_content %}

    <h1 class="heading-large">
			{{ uploaded_file_name }}
		</h1>

		<p>
      {{ banner(flash_message, with_tick=True) }}
		</p>

		<ul class="grid-row job-totals">
			<li class="column-one-third">
				{{ big_number(
					counts.total,
					'text message' if 1 == counts.total else 'text messages'
				)}}
			</li>
			<li class="column-one-third">
				{{ big_number(
					counts.failed,
					'failed delivery' if 1 == counts.failed else 'failed deliveries'
				)}}
			</li>
			<li class="column-one-third">
				{{ big_number(
					cost, 'total cost'
				)}}
			</li>
		</ul>

    <p>
      Sent with template <a href="{{ url_for('.edit_service_template', service_id=service_id, template_id=1) }}">{{ template_used }}</a> on {{ uploaded_file_time | format_datetime}}
    </p>

    {% call(item) list_table(
      messages,
      caption='Messages',
      caption_visible=False,
      field_headings=[
        'To',
        'Message',
        right_aligned_field_heading('Delivery status')
      ]
    ) %}
      {% call field() %}
        <a href="{{ url_for('.view_notification', service_id=service_id, job_id=456, notification_id=item.id) }}">{{item.phone}}</a>
      {% endcall %}
      {% call field() %}
        <a href="{{ url_for('.view_notification', service_id=service_id, job_id=456, notification_id=item.id) }}">{{item.message[:50]}}â€¦</a>
      {% endcall %}
      {% call field(
        align='right',
        status='error' if item.status == 'Failed' else 'default'
      ) %}
				{{ item.status }}&emsp;{{ item.time }}
			{% endcall %}
    {% endcall %}

{% endblock %}
