{% extends "withnav_template.html" %}
{% from "components/table.html" import list_table, field, right_aligned_field_heading %}
{% from "components/big-number.html" import big_number %}
{% from "components/banner.html" import banner %}
{% from "components/sms-message.html" import sms_message %}

{% block page_title %}
  GOV.UK Notify | Notifications activity
{% endblock %}

{% block maincolumn_content %}

    <h1 class="heading-large">
      {{ uploaded_file_name }}
    </h1>

    {{ sms_message(
      template['content'],
    )}}

    <p class='heading-small'>
      Started {{ uploaded_file_time|format_datetime }}
    </p>

    <ul class="grid-row job-totals">
      <li class="column-one-quarter">
        {{ big_number(
          1, 'queued'
        )}}
      </li>
      <li class="column-one-quarter">
        {{ big_number(
          0, 'sent'
        )}}
      </li>
      <li class="column-one-quarter">
        {{ big_number(
          counts.failed,
          'failed'
        )}}
      </li>
      <li class="column-one-quarter">
        {{ big_number(
          cost, 'total cost'
        )}}
      </li>
    </ul>

    {% call(item) list_table(
      messages,
      caption=uploaded_file_name,
      caption_visible=False,
      empty_message="Messages go here",
      field_headings=[
        'To',
        'Message',
        right_aligned_field_heading('Status')
      ]
    ) %}
      {% call field() %}
        <a href="{{ url_for('.view_notification', service_id=service_id, job_id=456, notification_id=item.id) }}">{{item.phone}}</a>
      {% endcall %}
      {% call field() %}
        <a href="{{ url_for('.view_notification', service_id=service_id, job_id=456, notification_id=item.id) }}">{{item.message[:50]}}â€¦</a>
      {% endcall %}
      {% call field(
        align='right',
        status='error' if item.status == 'Failed' else 'default'
      ) %}
        {{ item.status }}&emsp;{{ item.time }}
      {% endcall %}
    {% endcall %}

{% endblock %}
