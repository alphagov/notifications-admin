{% extends "withnav_template.html" %}
{% from "components/email-message.html" import email_message %}
{% from "components/sms-message.html" import sms_message %}
{% from "components/page-footer.html" import page_footer %}
{% from "components/textbox.html" import textbox %}

{% block page_title %}
  {{ page_heading }} â€“ GOV.UK Notify
{% endblock %}

{% block maincolumn_content %}

  <h1 class="heading-large">{{ page_heading }}</h1>

  <form method="POST" enctype="multipart/form-data">

    {% if templates %}
      {% if not has_jobs %}
        {% if current_user.has_permissions(session.get('service_id', ''), ['manage_service']) %}
        {{ banner(
          """
            Send yourself a test message
          """,
          subhead='Next step',
          type="tip"
        )}}
        {% endif %}
      {% endif %}
      <div class="grid-row">
        {% for template in templates %}
          <div class="column-two-thirds">
            {% if 'email' == template_type %}
              {{ email_message(
                template.subject,
                template.formatted_as_markup,
                name=template.name
              ) }}
            {% elif 'sms' == template_type %}
              {{ sms_message(template.formatted_as_markup, name=template.name) }}
            {% endif %}
          </div>
          <div class="column-one-third">
            <div class="sms-message-use-links">
              {% if current_user.has_permissions(session.get('service_id', ''), ['manage_service']) %}
              <a href="{{ url_for(".send_messages", service_id=service_id, template_id=template.id) }}">Add recipients</a>
              <a href="{{ url_for(".send_message_to_self", service_id=service_id, template_id=template.id) }}">Send yourself a test</a>
              {% endif %}
              {% if current_user.has_permissions(session.get('service_id', ''), ['manage_templates']) %}
              <a href="{{ url_for(".edit_service_template", service_id=service_id, template_id=template.id) }}">Edit template</a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <p>
      {% if current_user.has_permissions(session.get('service_id', ''), ['manage_templates']) %}
      <a href="{{ url_for('.add_service_template', service_id=service_id, template_type=template_type) }}" class="button">Add a new template</a>
      {% endif %}
    </p>

  </form>
{% endblock %}
