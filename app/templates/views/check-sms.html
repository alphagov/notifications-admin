{% extends "withnav_template.html" %}
{% from "components/sms-message.html" import sms_message %}
{% from "components/table.html" import list_table, field %}
{% from "components/placeholder.html" import placeholder %}
{% from "components/page-footer.html" import page_footer %}

{% block page_title %}
  GOV.UK Notify | Send text messages
{% endblock %}

{% block maincolumn_content %}

  <h1 class="heading-large">Check and confirm</h1>

  {% if upload_result.rejects %}
    <h3 class="heading-small">The following numbers are invalid</h3>
    {% for rejected in upload_result.rejects %}
      <p>Line {{rejected.line_number}}: {{rejected.phone }}</a>
    {% endfor %}
    <p><a href="{{url_for('.send_sms', service_id=service_id, template_id=template_id)}}" class="button">Go back and resolve errors</a></p>

  {% else %}

    {{ sms_message(
      message_template|replace_placeholders(upload_result.valid[0])
    )}}

    <form method="POST" enctype="multipart/form-data">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <input type="submit" class="button" value="{{ "Send {} text message{}".format(upload_result.valid|count, '' if upload_result.valid|count == 1 else 's') }}" />
    </form>

    {% call(item) list_table(
      upload_result.valid,
      caption=original_file_name,
      field_headings=['Phone number']
    ) %}
      {% call field() %}
        {{ item.phone }}
      {% endcall %}
    {% endcall %}

  {% endif %}
{% endblock %}
