{% extends "withnav_template.html" %}
{% from "components/table.html" import list_table, field, right_aligned_field_heading %}
{% from "components/previous-next-navigation.html" import previous_next_navigation %}

{% block page_title %}
  Activity – GOV.UK Notify
{% endblock %}

{% block maincolumn_content %}

    <h1 class="heading-large">Activity</h1>
    <p>
      <a href="{{ url_for(".view_notifications", service_id=current_service.id, page=1) }}">All messages</a>
    </p>
    <p>
      <a href="{{ url_for(".view_notifications", service_id=current_service.id, type="sms", page=1) }}">Text messages</a>&emsp;
      <a href="{{ url_for(".view_notifications", service_id=current_service.id, type="email", page=1) }}">Email messages</a>
    </p>
    <p>
      <a href="{{ url_for(".view_notifications", service_id=current_service.id, status=['sent', 'delivered'], page=1) }}">Successful messages</a>&emsp;
      <a href="{{ url_for(".view_notifications", service_id=current_service.id, status=['failed', 'complaint', 'bounce'], page=1) }}">Failed messages</a>
    </p>
    {% call(item, row_number) list_table(
      notifications,
      caption="Recent activity",
      caption_visible=False,
      empty_message='You haven’t sent any notifications yet',
      field_headings=['Recipient', 'Template', 'Type', 'Job', 'Status', 'Time'])
    %}
      {% call field() %}
        {{ item.to }}
      {% endcall %}
      {% call field() %}
        <a href="{{ url_for(".choose_template", service_id=current_service.id, template_type=item.template.template_type, _anchor=item.template.name|linkable_name) }}">{{ item.template.name }}</a>
      {% endcall %}
      {% call field() %}
        {{ item.template.template_type }}
      {% endcall %}
      {% call field() %}
        {% if item.job %}
          <a href="{{ url_for(".view_job", service_id=current_service.id, job_id=item.job.id) }}">{{ item.job.original_file_name }}</a>
        {% endif %}
      {% endcall %}
      {% call field() %}
        {{ item.status }}
      {% endcall %}
      {% call field() %}
        {{ item.created_at | format_datetime }}
      {% endcall %}
    {% endcall %}
    <p class="table-show-more-link">
      <a href="{{ request.url }}&download=csv">Download csv</a>
    </p>
    {{ previous_next_navigation(prev_page, next_page) }}

{% endblock %}