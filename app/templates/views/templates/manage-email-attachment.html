{% extends "withnav_template.html" %}
{% from "components/page-header.html" import page_header %}
{% from "govuk_frontend_jinja/components/back-link/macro.html" import govukBackLink %}
{% from "govuk_frontend_jinja/components/summary-list/macro.html" import govukSummaryList %}
{% from "components/file-upload.html" import file_upload %}
{% from "components/page-footer.html" import page_footer %}
{% from "components/banner.html" import banner %}
{% from "components/form.html" import form_wrapper %}
{% set title = attachment.file_name %}
{% block service_page_title %}
  {{ title }}
{% endblock %}

{% block backLink %}
  {{ govukBackLink({ "href": url_for('main.email_template_manage_attachments', service_id=current_service.id, template_id=template.id) }) }}
{% endblock %}

{% block maincolumn_content %}

  {% if delete %}
    <div class="govuk-!-margin-bottom-6">
      {{ banner(
        'Are you sure you want to remove this file?',
        type='dangerous',
        delete_button='Yes, remove',
        action=url_for('main.email_template_manage_attachment', service_id=current_service.id, template_id=template.id, attachment_id=attachment.id, delete="true")
      ) }}
    </div>
  {% endif %}
  {{ page_header(title) }}
  {{ govukSummaryList({
    "classes": "notify-summary-list service-base-settings",
    "rows": [
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Link text"
        },
        "value": {
            "text": attachment.link_text or None,
            "classes": "govuk-summary-list__value--truncate" if attachment.link_text else "govuk-hint"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_link_text',
                      service_id=current_service.id,
                      template_id=template.id,
                      attachment_id=attachment.id,
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      },
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Available for"
        },
        "value": {
            "text": attachment.weeks_of_retention|string + " weeks after sending",
            "classes": "govuk-summary-list__value--truncate"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_retention',
                      service_id=current_service.id,
                      template_id=template.id,
                      attachment_id=attachment.id,
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      },
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Ask recipient for email address"
        },
        "value": {
            "text": "Yes" if attachment.email_confirmation else "No",
            "classes": "govuk-summary-list__value--truncate"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_email_confirmation',
                      service_id=current_service.id,
                      template_id=template.id,
                      attachment_id=attachment.id,
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      }
    ]
  }) }}
  {% if attachment.file_name in template.placeholders %}
    {{ page_footer(
      delete_link_text="Remove this file",
      delete_link=url_for('main.email_template_manage_attachment', service_id=current_service.id, template_id=template.id, attachment_id=attachment.id, delete=true),
    )}}
  {% else %}
  <p class="govuk-body">
    Notify will add a link in the email to the file for recipients to download.
  </p>
    {% call form_wrapper(class='top-gutter') %}
      {{ page_footer(
        "Add to template",
        delete_link_text="cancel",
        delete_link=url_for('main.email_template_manage_attachment', service_id=current_service.id, template_id=template.id, attachment_id=attachment.id, delete=true),
      ) }}
    {% endcall %}
  {% endif %}

{% endblock %}
