{% extends "withnav_template.html" %}
{% from "components/page-header.html" import page_header %}
{% from "govuk_frontend_jinja/components/back-link/macro.html" import govukBackLink %}
{% from "govuk_frontend_jinja/components/summary-list/macro.html" import govukSummaryList %}
{% from "components/file-upload.html" import file_upload %}
{% from "components/page-footer.html" import page_footer %}
{% from "components/banner.html" import banner %}
{% set title = 'Manage ‘' + placeholder + '’' if attachment else 'Add ‘' + placeholder + '’' %}
{% block service_page_title %}
  {{ title }}
{% endblock %}

{% block backLink %}
  {{ govukBackLink({ "href": url_for('main.email_template_manage_attachments', service_id=current_service.id, template_id=template.id) }) }}
{% endblock %}

{% block maincolumn_content %}

  {% if delete %}
    <div class="govuk-!-margin-bottom-6">
      {{ banner(
        'Are you sure you want to remove this file?',
        type='dangerous',
        delete_button='Yes, remove',
        action=url_for('main.email_template_manage_attachment', service_id=current_service.id, template_id=template.id, placeholder=placeholder, delete="true")
      ) }}
    </div>
  {% endif %}
  {{ page_header(title) }}
  {{ govukSummaryList({
    "classes": "notify-summary-list service-base-settings",
    "rows": [
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "File"
        },
        "value": {
            "html": attachment.file_name or file_upload(form.file),
            "classes": ""
        },
        "actions": {
          "items": [
            {
              "href": url_for('main.email_template_manage_attachment', service_id=current_service.id, template_id=template.id, placeholder=placeholder, delete=true),
              "text": "Remove",
              "visuallyHiddenText": "this file",
              "classes": "govuk-link govuk-link--destructive"
            }
          ] if attachment else []
        }
      },
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Link text"
        },
        "value": {
            "text": attachment.link_text or None,
            "classes": "govuk-summary-list__value--truncate" if attachment.link_text else "govuk-hint"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_link_text',
                      service_id=current_service.id,
                      template_id=template.id,
                      placeholder=placeholder.strip(),
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      },
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Available for"
        },
        "value": {
            "text": attachment.weeks_of_retention|string + " weeks after sending",
            "classes": "govuk-summary-list__value--truncate"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_retention',
                      service_id=current_service.id,
                      template_id=template.id,
                      placeholder=placeholder.strip(),
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      },
      {
        "key": {
            "classes": "notify-summary-list__key notify-summary-list__key--35-100",
            "text": "Ask recipient for email address"
        },
        "value": {
            "text": "Yes" if attachment.email_confirmation else "No",
            "classes": "govuk-summary-list__value--truncate"
        },
        "actions": {
          "items": [
              {
                  "href": url_for(
                      'main.email_template_manage_attachment_email_confirmation',
                      service_id=current_service.id,
                      template_id=template.id,
                      placeholder=placeholder.strip(),
                  ),
                  "text": "Change",
                  "visuallyHiddenText": "service name",
                  "classes": "govuk-link--no-visited-state"
              }
          ]
        }
      }
    ]
  }) }}
  {{ page_footer(
    secondary_link=url_for('main.view_template', service_id=current_service.id, template_id=template.id),
    secondary_link_text="Back to ‘" + template.name + "’"
  )}}
{% endblock %}
