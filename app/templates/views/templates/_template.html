{% from "components/banner.html" import banner_wrapper %}
{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}

<div class="govuk-grid-column-full">
  {% if template._template.archived %}
    <p class="hint">
      This template was deleted {{ template._template.updated_at|format_datetime_relative }}.
    </p>
  {% elif not current_user.has_permissions('send_messages', 'manage_api_keys', 'manage_templates', 'manage_service') or not user_has_template_permission %}
    <p class="top-gutter-1-3 {% if template.template_type != 'sms' %}bottom-gutter{% endif %}">
      If you need to send this
      {{ 1|message_count_label(template.template_type, suffix='') }}
      or edit this template, contact your manager.
    </p>
  {% else %}
    <div class="">
      <div class="govuk-grid-row">
        {% if template.template_type == 'letter' %}
          {% if letter_too_long %}
            {% call banner_wrapper(type='dangerous') %}
                {% include "partials/check/letter-too-long.html" %}
            {% endcall %}
          {% endif %}
        {% elif template.template_type == 'broadcast' %}
          {% if current_user.has_permissions('create_broadcasts') %}
            <div class="govuk-grid-column-one-half">
              <a href="{{ url_for(".broadcast", service_id=current_service.id, template_id=template.id) }}" class="govuk-link govuk-link--inverse pill-separate-item">
                Get ready to send
              </a>
            </div>
          {% endif %}
          {% if current_user.has_permissions('manage_templates') %}
            <div class="govuk-grid-column-one-half">
              <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="govuk-link govuk-link--inverse pill-separate-item">
                Edit<span class="govuk-visually-hidden"> this template</span>
              </a>
            </div>
          {% endif %}
        {% elif template.template_type != 'email' %}
          {% if current_user.has_permissions('send_messages', restrict_admin_usage=True) %}
            <div class="govuk-grid-column-one-half">
              <a href="{{ url_for(".set_sender", service_id=current_service.id, template_id=template.id) }}" class="govuk-link govuk-link--inverse pill-separate-item">
                Get ready to send<span class="govuk-visually-hidden"> a message using this template</span>
              </a>
            </div>
          {% endif %}
          {% if current_user.has_permissions('manage_templates') %}
            <div class="govuk-grid-column-one-half">
              <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="govuk-link govuk-link--inverse pill-separate-item">
                Edit
              </a>
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
<div class="govuk-grid-column-full template-container">
  {% if template.template_type == 'letter' and current_user.has_permissions('send_messages', restrict_admin_usage=True) and not letter_too_long %}
    <a href="{{ url_for(".set_sender", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-send">
      Get ready to send<span class="govuk-visually-hidden"> a message using this template</span>
    </a>
  {% endif %}
  {% if current_user.has_permissions('manage_templates') and template.template_type == 'letter' %}
    {% if not current_service.letter_branding_id %}
      <a href="{{ url_for(".letter_branding_request", service_id=current_service.id, from_template=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-branding">Add logo</a>
    {% endif %}
    <a href="{{ url_for(".edit_template_postage", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-postage">Change postage</span></a>
    <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-body">Edit<span class="govuk-visually-hidden"> letter template</span></a>
    {% if current_service.count_letter_contact_details %}
      <a href="{{ url_for(".set_template_sender", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Edit contact block</a>
    {% else %}
      <a href="{{ url_for(".service_add_letter_contact", service_id=current_service.id, from_template=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Add contact block</span></a>
    {% endif %}
  {% endif %}
  <style type="text/css">
    /* prevent postage from showing twice */
    .letter + .letter .letter-postage {
      display: none;
    }
  </style>
  {% if request.args.get('language') == "cy-en" %}
    <div class="letter">
      <p class="letter-postage letter-postage-second">
        Postage: second class
      </p>
      <img src="{{ asset_url('images/letter-examples/welsh.png') }}" alt="" loading="eager">
    </div>
  {% endif %}
  {% if request.args.get('language') != "cy" %}
    <div class="letter">
      {% if request.args.get('language') == "cy-en" %}
        <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-body">Edit<span class="govuk-visually-hidden"> letter template</span></a>
        {% if current_service.count_letter_contact_details %}
          <a href="{{ url_for(".set_template_sender", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Edit contact block</a>
        {% else %}
          <a href="{{ url_for(".service_add_letter_contact", service_id=current_service.id, from_template=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Add contact block</span></a>
        {% endif %}
      {% else %}
        <p class="letter-postage letter-postage-second">
          Postage: second class
        </p>
      {% endif %}
      <img src="{{ url_for('no_cookie.view_letter_template_preview', template_id=template.id, service_id=current_service.id, filetype='png', page=1) }}" alt="" loading="eager">
    </div>
  {% endif %}
  {% if request.args.get('language') == "en-cy" %}
    <div class="letter">
      <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-body">Edit<span class="govuk-visually-hidden"> letter template</span></a>
      {% if current_service.count_letter_contact_details %}
        <a href="{{ url_for(".set_template_sender", service_id=current_service.id, template_id=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Edit contact block</a>
      {% else %}
        <a href="{{ url_for(".service_add_letter_contact", service_id=current_service.id, from_template=template.id) }}" class="govuk-button govuk-button--secondary edit-template-link-letter-contact">Add contact block</span></a>
      {% endif %}
      <img src="{{ asset_url('images/letter-examples/welsh.png') }}" alt="" loading="eager">
    </div>
  {% endif %}
  {% if request.args.get('language') == "cy" %}
    <div class="letter">
      <p class="letter-postage letter-postage-second">
        Postage: second class
      </p>
      <img src="{{ asset_url('images/letter-examples/welsh.png') }}" alt="" loading="eager">
    </div>
  {% endif %}
  {% if current_user.has_permissions('manage_templates') and template.template_type == 'letter' %}
    {% if extra_pages %}
      <div class="letter" id="extra-pages">
        <img src="{{ asset_url('images/letter-examples/' + extra_pages) }}" alt="" loading="eager">
      </div>
      <span class="page-footer-link page-footer-delete-link-without-button bottom-gutter" style="margin-top: -10px; position: relative; top: -10px;">
        <a class="govuk-link govuk-link--destructive" href="{{ url_for('.view_template', service_id=current_service.id, template_id=template.id) }}">Delete {{ "Welsh translation" if extra_pages == "welsh.png" else "uploaded pages" }}</a>
      </span>
    {% else %}
    <div class="js-stick-at-bottom-when-scrolling">
      {{ govukButton({ "text": "Attach pages", "classes": "govuk-button--secondary", "href": url_for(".insert_pages_upload", service_id=current_service.id, template_id=template.id) }) }}
      <div style="float: right">
      {{ govukButton({ "text": "Change language", "classes": "govuk-button--secondary govuk-!-margin-left-3", "href": url_for(".edit_service_template_language", service_id=current_service.id, template_id=template.id) }) }}
      </div>
    </div>
    {% endif %}
  {% endif %}
</div>
