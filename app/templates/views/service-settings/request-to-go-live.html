{% extends "withnav_template.html" %}
{% from "components/form.html" import form_wrapper %}
{% from "components/page-header.html" import page_header %}
{% from "components/page-footer.html" import page_footer %}
{% from "components/task-list.html" import task_list_wrapper, task_list_item %}

{% block service_page_title %}
  Get ready to go live
{% endblock %}

{% block maincolumn_content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {{ page_header('Get ready to go live') }}

      <p class="govuk-body">Your service is in <a href="{{ url_for('main.guidance_trial_mode') }}" class="govuk-link govuk-link--no-visited-state">trial mode</a>.</p>
      <p class="govuk-body">Before you can go live you must:</p>
      <ol class="govuk-list govuk-list--number">
        <li>Review your <a href="{{ url_for('main.service_settings', service_id=current_service.id) }}" class="govuk-link govuk-link--no-visited-state">settings</a>.</li>
        <li>Complete the tasks on this page.</li>
      </ol>

      <p class="govuk-body">When you’re ready, we’ll check that your service meets our <a href="{{ url_for('main.terms_of_use') }}" class="govuk-link govuk-link--no-visited-state">terms of use</a>.</p>

      <p class="govuk-body">If it does, we’ll make your service live within one working day.</p>

      <h2 class="heading-medium">Set up your service</h2>

      {% call task_list_wrapper() %}
        {{ task_list_item(
          current_service.has_estimated_usage,
          'Tell us what you expect to send',
          url_for('main.estimate_usage', service_id=current_service.id),
        ) }}
        {{ task_list_item(
          current_service.has_team_members_with_manage_service_permission,
          'Add a team member with the ‘manage settings’ permission',
          url_for('main.manage_users', service_id=current_service.id),
        ) }}
        {{ task_list_item(
          current_service.has_templates,
          'Add templates with examples of your content',
          url_for('main.choose_template', service_id=current_service.id),
        ) }}
        {% if current_service.intending_to_send_email %}
          {{ task_list_item(
            current_service.has_email_reply_to_address,
            'Add a reply-to email address',
            url_for('main.service_add_email_reply_to', service_id=current_service.id),
          ) }}
        {% endif %}
        {% if (
          current_service.intending_to_send_sms
          and current_service.shouldnt_use_govuk_as_sms_sender
        ) %}
          {{ task_list_item(
            not current_service.sms_sender_is_govuk,
            'Change your Text message sender ID',
            url_for('main.service_sms_senders', service_id=current_service.id),
          ) }}
        {% endif %}
      {% endcall %}
      {% if current_service.able_to_accept_agreement %}
      <h2 class="heading-medium">Make sure your organisation can use GOV.UK Notify</h2>
      {% call task_list_wrapper() %}
      {{ task_list_item(
        current_service.organisation.agreement_signed,
        'Accept our data processing and financial agreement',
        url_for('main.service_agreement', service_id=current_service.id),
      ) }}
      {% endcall %}
      {% endif %}
      {% if not current_user.is_gov_user %}
        <p class="govuk-body">
          Only team members with a government email address can request to go live.
        </p>
      {% elif (not current_service.go_live_checklist_completed) or (current_service.able_to_accept_agreement and not current_service.organisation.agreement_signed) %}
        <p class="govuk-body">
          You must complete these steps before you can request to go live.
        </p>
      {% elif current_service.has_active_go_live_request %}
        <p class="govuk-body">
          Your team has already sent a request to go live for this service.
        </p>
      {% else %}
        {% call form_wrapper() %}
          {{ page_footer('Ready to go live') }}
        {% endcall %}
      {% endif %}
    </div>
  </div>
{% endblock %}
